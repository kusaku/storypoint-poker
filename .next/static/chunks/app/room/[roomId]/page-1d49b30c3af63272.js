(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[684],{8343:function(e,s,t){Promise.resolve().then(t.bind(t,2321))},2321:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return a}});var o=t(7437),n=t(2265),l=t(9376),r=t(8680);let d=[0,1,2,3,5,8,13,21,34,55,89,"?"];function a(){let e=(0,l.useParams)(),s=(0,l.useSearchParams)(),t=e.roomId,a=s.get("name")||"Anonymous",c="true"===s.get("host"),[i,m]=(0,n.useState)(null),[x,g]=(0,n.useState)({users:[],revealed:!1}),[u,h]=(0,n.useState)(null),[v,p]=(0,n.useState)(null),[b,j]=(0,n.useState)(!1);(0,n.useEffect)(()=>{console.log("Room page mounted",{roomId:t,userName:a,isHost:c});let e=window.location.origin;console.log("Connecting to Socket.io server:",e);let s=(0,r.io)(e,{transports:["polling","websocket"],reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3,timeout:2e4});return s.on("connect",()=>{console.log("✅ Connected to Socket.io server, socket ID:",s.id),console.log("Joining room:",{roomId:t,userName:a}),j(!0),p(null),s.emit("join-room",{roomId:t,userName:a})}),s.on("connect_error",s=>{console.error("❌ Socket.io connection error:",s),j(!1),p("Failed to connect to Socket.io server at ".concat(e,". Make sure the server is running and the URL is correct."))}),s.on("disconnect",()=>{console.log("⚠️ Disconnected from Socket.io server"),j(!1)}),s.on("room-state",e=>{console.log("Room state updated:",e),g(e)}),s.on("user-joined",e=>{console.log("User joined:",e),g(s=>({...s,users:[...s.users.filter(s=>s.id!==e.id),e]}))}),s.on("user-left",e=>{console.log("User left:",e),g(s=>({...s,users:s.users.filter(s=>s.id!==e)}))}),s.on("vote-received",e=>{console.log("Vote received:",e),g(s=>({...s,users:s.users.map(s=>s.id===e.userId?{...s,vote:e.vote,hasVoted:!0}:s)}))}),s.on("votes-revealed",()=>{g(e=>({...e,revealed:!0}))}),s.on("votes-reset",()=>{g(e=>({...e,revealed:!1,users:e.users.map(e=>({...e,vote:null,hasVoted:!1}))})),h(null)}),m(s),()=>{s.close()}},[t,a]);let N=e=>{console.log("Vote clicked:",e,{socket:!!i,revealed:x.revealed}),i&&!x.revealed?(h(e),console.log("Emitting vote:",{roomId:t,vote:e}),i.emit("vote",{roomId:t,vote:e})):console.warn("Cannot vote:",{hasSocket:!!i,revealed:x.revealed})},f=x.users.length>0&&x.users.every(e=>e.hasVoted);return(0,o.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:(0,o.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,o.jsx)("div",{className:"bg-white rounded-lg shadow-md p-4 mb-4",children:(0,o.jsxs)("div",{className:"flex justify-between items-center",children:[(0,o.jsxs)("div",{children:[(0,o.jsxs)("h1",{className:"text-2xl font-bold text-indigo-600",children:["Room: ",t]}),(0,o.jsxs)("p",{className:"text-gray-600",children:["Welcome, ",a,"!"]}),(0,o.jsx)("div",{className:"flex items-center gap-2 mt-1",children:b?(0,o.jsx)("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-1 rounded",children:"\uD83D\uDFE2 Connected"}):(0,o.jsx)("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded",children:"\uD83D\uDD34 Disconnected"})})]}),(0,o.jsxs)("div",{className:"text-right",children:[(0,o.jsxs)("p",{className:"text-sm text-gray-500",children:["Participants: ",x.users.length]}),c&&(0,o.jsx)("span",{className:"text-xs bg-indigo-100 text-indigo-800 px-2 py-1 rounded",children:"Host"})]})]})}),v&&(0,o.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:(0,o.jsxs)("div",{className:"flex items-start",children:[(0,o.jsx)("div",{className:"flex-shrink-0",children:(0,o.jsx)("span",{className:"text-red-400 text-xl",children:"⚠️"})}),(0,o.jsxs)("div",{className:"ml-3",children:[(0,o.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Connection Error"}),(0,o.jsx)("p",{className:"mt-1 text-sm text-red-700",children:v}),(0,o.jsxs)("p",{className:"mt-2 text-xs text-red-600",children:[(0,o.jsx)("strong",{children:"For local testing:"})," Make sure the Socket.io server is running: ",(0,o.jsx)("code",{className:"bg-red-100 px-1 rounded",children:"cd server && npm run dev"}),(0,o.jsx)("br",{}),(0,o.jsx)("strong",{children:"For production:"})," Set ",(0,o.jsx)("code",{className:"bg-red-100 px-1 rounded",children:"NEXT_PUBLIC_SOCKET_URL"})," in Vercel environment variables."]})]})]})}),(0,o.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[(0,o.jsxs)("div",{className:"lg:col-span-2 space-y-4",children:[(0,o.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,o.jsx)("h2",{className:"text-xl font-bold mb-4 text-gray-800",children:"Select Your Vote"}),(0,o.jsx)("div",{className:"grid grid-cols-4 sm:grid-cols-6 gap-3",children:d.map(e=>(0,o.jsx)("button",{onClick:()=>N(e),disabled:x.revealed,className:"\n                      aspect-square rounded-lg font-bold text-lg transition-all\n                      ".concat(u===e?"bg-indigo-600 text-white scale-110 shadow-lg":"bg-gray-100 hover:bg-gray-200 text-gray-800","\n                      ").concat(x.revealed?"opacity-50 cursor-not-allowed":"cursor-pointer","\n                    "),children:e},e))}),null!==u&&!x.revealed&&(0,o.jsxs)("p",{className:"mt-4 text-center text-green-600 font-medium",children:["✓ You voted: ",u]})]}),c&&(0,o.jsx)("div",{className:"bg-white rounded-lg shadow-md p-4",children:(0,o.jsxs)("div",{className:"flex gap-3",children:[(0,o.jsx)("button",{onClick:()=>{console.log("Reveal clicked",{socket:!!i,isHost:c}),i&&c&&(console.log("Emitting reveal-votes:",{roomId:t}),i.emit("reveal-votes",{roomId:t}))},disabled:!f||x.revealed,className:"flex-1 bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed font-medium",children:x.revealed?"Votes Revealed":"Reveal Votes"}),(0,o.jsx)("button",{onClick:()=>{console.log("Reset clicked",{socket:!!i,isHost:c}),i&&c&&(console.log("Emitting reset-votes:",{roomId:t}),i.emit("reset-votes",{roomId:t}))},disabled:!x.revealed,className:"flex-1 bg-orange-600 text-white py-2 px-4 rounded-lg hover:bg-orange-700 disabled:bg-gray-300 disabled:cursor-not-allowed font-medium",children:"Reset"})]})})]}),(0,o.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-4",children:[(0,o.jsx)("h2",{className:"text-xl font-bold mb-4 text-gray-800",children:"Participants"}),(0,o.jsx)("div",{className:"space-y-2",children:x.users.map(e=>{var s;return(0,o.jsxs)("div",{className:"flex justify-between items-center p-2 rounded bg-gray-50",children:[(0,o.jsx)("span",{className:"font-medium",children:e.name}),(0,o.jsx)("span",{className:"text-sm",children:x.revealed?(0,o.jsx)("span",{className:"font-bold text-indigo-600",children:null!==(s=e.vote)&&void 0!==s?s:"—"}):(0,o.jsx)("span",{className:e.hasVoted?"text-green-600":"text-gray-400",children:e.hasVoted?"✓":"○"})})]},e.id)})}),x.revealed&&(0,o.jsxs)("div",{className:"mt-4 p-3 bg-indigo-50 rounded-lg",children:[(0,o.jsx)("p",{className:"text-sm font-semibold text-indigo-800 mb-2",children:"Results:"}),(0,o.jsx)("div",{className:"space-y-1",children:x.users.map(e=>{var s;return(0,o.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,o.jsxs)("span",{children:[e.name,":"]}),(0,o.jsx)("span",{className:"font-bold",children:null!==(s=e.vote)&&void 0!==s?s:"—"})]},e.id)})})]})]})]})]})})}}},function(e){e.O(0,[721,971,117,744],function(){return e(e.s=8343)}),_N_E=e.O()}]);